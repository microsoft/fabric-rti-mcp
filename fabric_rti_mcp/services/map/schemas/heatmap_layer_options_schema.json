{
  "$schema": "https://json-schema.org/draft-07/schema#",
  "title": "Heatmap Layer Options",
  "description": "Configuration options for heatmap layer visualization (point data). This object should be JSON.stringify'd and stored in layerSettings[].options as a string.",
  "type": "object",
  "properties": {
    "color": {
      "type": "string",
      "description": "Base color (not used for heatmap, color gradient is defined in heatmapOptions.color)",
      "default": "#1e90ff"
    },
    "type": {
      "type": "string",
      "enum": ["vector", "raster"],
      "description": "Layer type",
      "default": "vector"
    },
    "visible": {
      "type": "boolean",
      "description": "Whether the layer is visible",
      "default": true
    },
    "pointLayerType": {
      "type": "string",
      "enum": ["bubble", "heatmap"],
      "description": "Type of point visualization - must be 'heatmap' for heatmap layers",
      "default": "heatmap"
    },
    "enablePopups": {
      "type": "boolean",
      "description": "Whether to show popups on click",
      "default": true
    },
    "minZoom": {
      "type": "number",
      "description": "Minimum zoom level to render the layer (inclusive)",
      "minimum": 1,
      "maximum": 23,
      "default": 1
    },
    "maxZoom": {
      "type": "number",
      "description": "Maximum zoom level to render the layer (exclusive)",
      "minimum": 1,
      "maximum": 23,
      "default": 23
    },
    "heatmapWeight": {
      "type": "string",
      "description": "Property name to use for heatmap weighting (influences intensity)",
      "examples": ["population", "incidents", "sales"]
    },
    "heatmapOptions": {
      "type": "object",
      "description": "Heatmap-specific visualization options",
      "properties": {
        "opacity": {
          "type": "number",
          "description": "Opacity of the heatmap (0-1)",
          "minimum": 0,
          "maximum": 1,
          "default": 1,
          "examples": [1, 0.8, 0.6]
        },
        "intensity": {
          "type": "number",
          "description": "Intensity/brightness of the heatmap (1-100)",
          "minimum": 1,
          "maximum": 100,
          "default": 1,
          "examples": [1, 50, 100]
        },
        "radius": {
          "type": "number",
          "description": "Radius of influence for each point in pixels (1-100)",
          "minimum": 1,
          "maximum": 100,
          "default": 30,
          "examples": [20, 30, 50]
        },
        "weight": {
          "description": "MapLibre expression for data-driven weighting. Typically uses ['max', ['get', propertyName], 0]",
          "oneOf": [
            {
              "type": "number",
              "description": "Fixed weight value"
            },
            {
              "type": "array",
              "description": "MapLibre expression for dynamic weight",
              "examples": [
                ["max", ["get", "population"], 0],
                ["max", ["get", "intensity"], 1]
              ]
            }
          ]
        },
        "color": {
          "type": "array",
          "description": "Color gradient expression for the heatmap. Uses MapLibre interpolate expression with heatmap-density stops from 0 to 1",
          "default": [
            "interpolate",
            ["linear"],
            ["heatmap-density"],
            0, "rgba(0,0,255,0)",
            0.1, "royalblue",
            0.3, "cyan",
            0.5, "lime",
            0.7, "yellow",
            1, "red"
          ],
          "examples": [
            [
              "interpolate",
              ["linear"],
              ["heatmap-density"],
              0, "rgba(33,102,172,0)",
              0.2, "rgb(103,169,207)",
              0.4, "rgb(209,229,240)",
              0.6, "rgb(253,219,199)",
              0.8, "rgb(239,138,98)",
              1, "rgb(178,24,43)"
            ]
          ]
        }
      }
    }
  },
  "examples": [
    {
      "comment": "Basic heatmap with default gradient",
      "color": "#1e90ff",
      "type": "vector",
      "visible": true,
      "pointLayerType": "heatmap",
      "enablePopups": false,
      "heatmapOptions": {
        "opacity": 0.8,
        "intensity": 1,
        "radius": 30,
        "color": [
          "interpolate",
          ["linear"],
          ["heatmap-density"],
          0, "rgba(0,0,255,0)",
          0.1, "royalblue",
          0.3, "cyan",
          0.5, "lime",
          0.7, "yellow",
          1, "red"
        ]
      }
    },
    {
      "comment": "Weighted heatmap based on population data",
      "color": "#1e90ff",
      "type": "vector",
      "visible": true,
      "pointLayerType": "heatmap",
      "enablePopups": false,
      "heatmapWeight": "population",
      "heatmapOptions": {
        "opacity": 0.9,
        "intensity": 50,
        "radius": 40,
        "weight": ["max", ["get", "population"], 0],
        "color": [
          "interpolate",
          ["linear"],
          ["heatmap-density"],
          0, "rgba(0,0,0,0)",
          0.2, "rgb(103,0,31)",
          0.4, "rgb(178,24,43)",
          0.6, "rgb(239,138,98)",
          0.8, "rgb(253,219,199)",
          1, "rgb(255,255,255)"
        ]
      }
    },
    {
      "comment": "High intensity heatmap with custom blue-red gradient",
      "color": "#1e90ff",
      "type": "vector",
      "visible": true,
      "pointLayerType": "heatmap",
      "enablePopups": false,
      "heatmapOptions": {
        "opacity": 1,
        "intensity": 80,
        "radius": 25,
        "color": [
          "interpolate",
          ["linear"],
          ["heatmap-density"],
          0, "rgba(33,102,172,0)",
          0.25, "rgb(103,169,207)",
          0.5, "rgb(209,229,240)",
          0.75, "rgb(253,219,199)",
          1, "rgb(178,24,43)"
        ]
      }
    }
  ]
}
