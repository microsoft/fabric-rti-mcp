{
  "$schema": "https://json-schema.org/draft-07/schema#",
  "title": "Polygon Layer Options",
  "description": "Configuration options for polygon layer visualization (Polygon/MultiPolygon data) with optional 3D extrusion. This object should be JSON.stringify'd and stored in layerSettings[].options as a string.",
  "type": "object",
  "properties": {
    "color": {
      "type": "string",
      "description": "Base color of polygons (hex color)",
      "default": "#1e90ff",
      "examples": ["#1e90ff", "#FF5733", "#00AA00"]
    },
    "type": {
      "type": "string",
      "enum": ["vector", "raster"],
      "description": "Layer type",
      "default": "vector"
    },
    "visible": {
      "type": "boolean",
      "description": "Whether the layer is visible",
      "default": true
    },
    "enablePopups": {
      "type": "boolean",
      "description": "Whether to show popups on click",
      "default": true
    },
    "minZoom": {
      "type": "number",
      "description": "Minimum zoom level to render the layer (inclusive)",
      "minimum": 1,
      "maximum": 23,
      "default": 1
    },
    "maxZoom": {
      "type": "number",
      "description": "Maximum zoom level to render the layer (exclusive)",
      "minimum": 1,
      "maximum": 23,
      "default": 23
    },
    "sourceLayer": {
      "type": "string",
      "description": "Source layer name for vector tile sources (PMTiles, MVT)",
      "examples": ["buildings", "parcels", "zones"]
    },
    "allowExtrusions": {
      "type": "boolean",
      "description": "Whether to enable 3D extrusion for polygons with height data",
      "default": false
    },
    "polygonOptions": {
      "type": "object",
      "description": "2D polygon visualization options (flat polygons)",
      "properties": {
        "fillOpacity": {
          "type": "number",
          "description": "Opacity of the polygon fill (0-1)",
          "minimum": 0,
          "maximum": 1,
          "default": 0.6,
          "examples": [0.6, 0.8, 1]
        },
        "fillColor": {
          "description": "Fill color of the polygon (can be expression for series grouping)",
          "oneOf": [
            {
              "type": "string",
              "description": "Simple hex color",
              "examples": ["#1e90ff", "#FF0000"]
            },
            {
              "type": "array",
              "description": "MapLibre expression for data-driven coloring",
              "examples": [
                ["match", ["get", "zone"], "residential", "#FFFF00", "commercial", "#FF0000", "#CCCCCC"]
              ]
            }
          ],
          "default": "#1e90ff"
        },
        "enableSeriesGroup": {
          "type": "boolean",
          "description": "Whether to color polygons by a categorical property",
          "default": false
        },
        "seriesGroup": {
          "type": "string",
          "description": "Property name to use for series grouping/coloring",
          "examples": ["zone_type", "status", "category"]
        },
        "filter": {
          "type": "array",
          "description": "MapLibre filter expression. Typically used to hide polygons when extrusion is enabled for features with height property",
          "examples": [
            ["all"],
            ["!", ["has", "height"]],
            ["<=", ["get", "height"], 0]
          ]
        }
      }
    },
    "polygonExtrusionOptions": {
      "type": "object",
      "description": "3D polygon extrusion options (when allowExtrusions is true)",
      "properties": {
        "fillOpacity": {
          "type": "number",
          "description": "Opacity of the extruded polygon (0-1)",
          "minimum": 0,
          "maximum": 1,
          "default": 0.6,
          "examples": [0.6, 0.8, 1]
        },
        "fillColor": {
          "description": "Fill color of the extruded polygon (can be expression for series grouping)",
          "oneOf": [
            {
              "type": "string",
              "description": "Simple hex color"
            },
            {
              "type": "array",
              "description": "MapLibre expression for data-driven coloring"
            }
          ],
          "default": "#1e90ff"
        },
        "height": {
          "description": "Height expression for 3D extrusion. Typically uses interpolate to scale property values to visual heights",
          "oneOf": [
            {
              "type": "number",
              "description": "Fixed height in meters"
            },
            {
              "type": "array",
              "description": "MapLibre expression for data-driven height",
              "examples": [
                ["interpolate", ["linear"], ["get", "height"], 0, 0, 100, 500],
                ["*", ["get", "floors"], 3]
              ]
            }
          ]
        },
        "heightProperty": {
          "type": "string",
          "description": "Property name used for height calculation (metadata, not sent to map)",
          "examples": ["building_height", "floors", "elevation"]
        },
        "base": {
          "description": "Base height offset for the extrusion",
          "oneOf": [
            {
              "type": "number",
              "description": "Fixed base height in meters"
            },
            {
              "type": "array",
              "description": "MapLibre expression for data-driven base height"
            }
          ],
          "default": 0
        },
        "enableSeriesGroup": {
          "type": "boolean",
          "description": "Whether to color extruded polygons by a categorical property",
          "default": false
        },
        "seriesGroup": {
          "type": "string",
          "description": "Property name to use for series grouping/coloring"
        },
        "filter": {
          "type": "array",
          "description": "MapLibre filter expression. Typically used to show only features with height property",
          "examples": [
            ["all"],
            ["has", "height"],
            [">", ["get", "height"], 0]
          ]
        }
      }
    },
    "tooltipKeys": {
      "type": "array",
      "description": "Array of property names to show in tooltips",
      "items": {
        "type": "string"
      },
      "examples": [["name", "area", "type"]]
    },
    "dataLabelKeys": {
      "type": "array",
      "description": "Array of property names to display as labels at polygon centroids",
      "items": {
        "type": "string"
      },
      "examples": [["name", "code"]]
    },
    "dataLabelOptions": {
      "type": "object",
      "description": "Styling options for data labels",
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": false
        },
        "color": {
          "type": "string",
          "default": "#000000"
        },
        "size": {
          "type": "number",
          "default": 12
        },
        "textStrokeColor": {
          "type": "string",
          "default": "#ffffff"
        },
        "textStrokeWidth": {
          "type": "number",
          "default": 1
        },
        "allowOverlap": {
          "type": "boolean",
          "default": false
        }
      }
    }
  },
  "examples": [
    {
      "comment": "Simple 2D polygon layer",
      "color": "#1e90ff",
      "type": "vector",
      "visible": true,
      "enablePopups": true,
      "allowExtrusions": false,
      "polygonOptions": {
        "fillOpacity": 0.6,
        "fillColor": "#1e90ff"
      },
      "tooltipKeys": ["name", "area"]
    },
    {
      "comment": "Polygon layer with series grouping by zone type",
      "color": "#CCCCCC",
      "type": "vector",
      "visible": true,
      "enablePopups": true,
      "allowExtrusions": false,
      "polygonOptions": {
        "fillOpacity": 0.7,
        "enableSeriesGroup": true,
        "seriesGroup": "zone_type",
        "fillColor": [
          "match",
          ["get", "zone_type"],
          "residential", "#FFFF00",
          "commercial", "#FF0000",
          "industrial", "#A52A2A",
          "parks", "#00FF00",
          "#CCCCCC"
        ]
      },
      "tooltipKeys": ["name", "zone_type", "area"]
    },
    {
      "comment": "3D extruded buildings based on height property",
      "color": "#1e90ff",
      "type": "vector",
      "visible": true,
      "enablePopups": true,
      "allowExtrusions": true,
      "polygonOptions": {
        "fillOpacity": 0.6,
        "fillColor": "#1e90ff",
        "filter": ["!", ["has", "height"]]
      },
      "polygonExtrusionOptions": {
        "fillOpacity": 0.8,
        "fillColor": "#1e90ff",
        "heightProperty": "height",
        "height": [
          "interpolate",
          ["linear"],
          ["get", "height"],
          0, 0,
          100, 500
        ],
        "base": 0,
        "filter": ["has", "height"]
      },
      "tooltipKeys": ["name", "height", "floors"]
    },
    {
      "comment": "3D extruded buildings with series grouping",
      "color": "#CCCCCC",
      "type": "vector",
      "visible": true,
      "enablePopups": true,
      "allowExtrusions": true,
      "polygonOptions": {
        "fillOpacity": 0.6,
        "enableSeriesGroup": true,
        "seriesGroup": "building_type",
        "fillColor": [
          "match",
          ["get", "building_type"],
          "residential", "#FFA500",
          "office", "#4169E1",
          "retail", "#32CD32",
          "#CCCCCC"
        ],
        "filter": ["!", ["has", "height"]]
      },
      "polygonExtrusionOptions": {
        "fillOpacity": 0.9,
        "enableSeriesGroup": true,
        "seriesGroup": "building_type",
        "fillColor": [
          "match",
          ["get", "building_type"],
          "residential", "#FFA500",
          "office", "#4169E1",
          "retail", "#32CD32",
          "#CCCCCC"
        ],
        "heightProperty": "floors",
        "height": [
          "interpolate",
          ["linear"],
          ["get", "floors"],
          1, 10,
          50, 200
        ],
        "filter": ["has", "height"]
      },
      "tooltipKeys": ["name", "building_type", "floors"],
      "dataLabelKeys": ["name"],
      "dataLabelOptions": {
        "enabled": true,
        "color": "#000000",
        "size": 10,
        "textStrokeColor": "#ffffff",
        "textStrokeWidth": 2
      }
    }
  ]
}
